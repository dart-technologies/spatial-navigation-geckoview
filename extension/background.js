!function(){"use strict";function e(e){if(e instanceof Error)return JSON.stringify({name:e.name,message:e.message,stack:e.stack});if(e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message)try{return JSON.stringify({...e,message:e.message})}catch{}try{return JSON.stringify(e)}catch{return String(e)}}try{browser.runtime.onMessage.addListener((r,s,a)=>{console.log(`[SpatialNav-BG] Received message: ${e(r)}`);try{const s=browser.runtime.sendNativeMessage;if("function"!=typeof s)return console.error("[SpatialNav-BG] sendNativeMessage unavailable on browser.runtime"),a({success:!1,error:"sendNativeMessage unavailable"}),!0;s("flutter_geckoview",r).then(r=>{console.log(`[SpatialNav-BG] Native response: ${e(r)}`),a({success:!0,nativeUser:r})}).catch(r=>{const s=r instanceof Error?`${r.name}: ${r.message}`:"string"==typeof r?.message?r.message:String(r);console.error(`[SpatialNav-BG] Native relay error: ${s} ${e(r)}`),a({success:!1,error:r?.message||r})})}catch(r){console.error(`[SpatialNav-BG] Exception relaying to native: ${e(r)}`),a({success:!1,error:r?.message||String(r)})}return!0})}catch(e){console.error("[SpatialNav-BG] Error registering relay listener:",e)}}();
